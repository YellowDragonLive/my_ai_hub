<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极客 AI 助手 | Geek AI Hub</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div class="app-container">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="logo">🤖 Geek AI</h1>
                <button class="new-chat-btn" id="newChatBtn">
                    <span>+</span> 新对话
                </button>
            </div>

            <!-- 搜索框 -->
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="搜索会话...">
            </div>

            <!-- 会话列表 -->
            <div class="conversation-list" id="conversationList">
                <!-- 动态填充 -->
            </div>

            <!-- 设置按钮 -->
            <div class="sidebar-footer">
                <button class="settings-btn" id="settingsBtn">
                    ⚙️ 设置
                </button>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 顶部栏 -->
            <header class="top-bar">
                <div class="model-selection-group">
                    <div class="model-selector">
                        <select id="modelSelect">
                            <!-- 动态填充 -->
                        </select>
                    </div>
                    <div class="anti-truncate-wrapper">
                        <label class="switch" title="启用流式抗截断模式">
                            <input type="checkbox" id="antiTruncateToggle">
                            <span class="slider round"></span>
                        </label>
                        <span class="anti-truncate-label">抗截断</span>
                    </div>
                </div>
                <div class="pattern-indicator" id="patternIndicator">
                    <!-- 当前选中的 Pattern -->
                </div>
            </header>

            <!-- 消息区域 -->
            <div class="messages-container" id="messagesContainer">
                <div class="welcome-screen" id="welcomeScreen">
                    <h2>👋 欢迎使用极客 AI 助手</h2>
                    <p>输入 <kbd>/</kbd> 快速调用技能库</p>
                    <div class="quick-patterns" id="quickPatterns">
                        <!-- 热门 Patterns -->
                    </div>
                </div>
            </div>

            <!-- 输入区域 -->
            <div class="input-container">
                <div class="pattern-search-popup" id="patternPopup">
                    <div class="pattern-list" id="patternList">
                        <!-- 动态填充 -->
                    </div>
                </div>

                <div class="input-wrapper">
                    <textarea id="messageInput" placeholder="输入消息，或按 / 调用技能..." rows="1"></textarea>
                    <div class="input-actions">
                        <button class="suggest-btn" id="suggestBtn" title="AI 推荐技能">
                            🎯
                        </button>
                        <button class="enhance-btn" id="enhanceBtn" title="AI 优化 Prompt">
                            ✨
                        </button>
                        <button class="send-btn" id="sendBtn">
                            发送
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 设置弹窗 -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⚙️ API 配置</h3>
                <button class="close-btn" id="closeSettingsBtn">×</button>
            </div>
            <div class="modal-body">
                <div class="config-list" id="configList">
                    <!-- 动态填充 -->
                </div>
                <button class="add-config-btn" id="addConfigBtn">+ 添加配置</button>

                <div class="config-form" id="configForm" style="display:none;">
                    <div class="form-group">
                        <label>配置名称</label>
                        <input type="text" id="configName" placeholder="例如：OpenAI API">
                    </div>
                    <div class="form-group">
                        <label>厂商</label>
                        <select id="configVendor">
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="google">Google</option>
                            <option value="custom">自定义</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>模型</label>
                        <input type="text" id="configModel" placeholder="例如：gpt-4">
                    </div>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="configApiKey" placeholder="sk-...">
                    </div>
                    <div class="form-group">
                        <label>Base URL（可选）</label>
                        <input type="text" id="configBaseUrl" placeholder="https://api.openai.com">
                    </div>
                    <div class="form-actions">
                        <button class="cancel-btn" id="cancelConfigBtn">取消</button>
                        <button class="save-btn" id="saveConfigBtn">保存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 智能生成弹窗 -->
    <div class="modal" id="generateModal">
        <div class="modal-content wide">
            <div class="modal-header">
                <h3>🆕 智能生成技能 (Skill)</h3>
                <button class="close-btn" id="closeGenerateBtn">×</button>
            </div>
            <div class="modal-body">
                <div id="generateStep1">
                    <div class="form-group">
                        <label>你想让 AI 帮你做什么？</label>
                        <textarea id="genDescription" placeholder="例如：帮我写一个短视频分镜脚本，需要包含镜头号、画面内容、对白和时长..."
                            rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>参考已有技能 (可选)</label>
                        <div class="ref-chips" id="refChips">
                            <!-- 动态填充建议的 Pattern -->
                        </div>
                    </div>
                    <button class="send-btn" id="startGenBtn" style="width: 100%; margin-top: 12px;">由 AI 开始生成</button>
                </div>

                <div id="generateStep2" style="display: none;">
                    <div class="form-group">
                        <label>生成的内容预览 (您可以直接编辑)</label>
                        <textarea id="genContentPreview" rows="12"
                            style="font-family: monospace; font-size: 13px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label>技能名称 (建议使用英文，如 create_story)</label>
                        <input type="text" id="genPatternName" placeholder="例如：create_video_script">
                    </div>
                    <div class="form-actions">
                        <button class="cancel-btn" id="backToStep1">返回修改</button>
                        <button class="save-btn" id="saveGenBtn">确认保存并启用</button>
                    </div>
                </div>

                <div id="genLoading" style="display: none; text-align: center; padding: 40px;">
                    <span class="loading-dots" style="font-size: 24px;">AI 正在构建中</span>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>

</html>